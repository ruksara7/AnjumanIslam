<script>
document.addEventListener('DOMContentLoaded', function () {

    const navMenu  = document.getElementById('navMenu');
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    const dropdownParents = document.querySelectorAll('.dropdown');

    /* ========= MAIN MENU ========= */
    function openMenu(){
        navMenu.classList.add('active');
        mobileBtn.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeMenu(){
        navMenu.classList.remove('active');
        mobileBtn.classList.remove('active');
        document.body.style.overflow = '';
        closeAllDropdowns();
    }

    mobileBtn.addEventListener('click', function(e){
        e.stopPropagation();
        navMenu.classList.contains('active') ? closeMenu() : openMenu();
    });

    /* ========= DROPDOWN ========= */
    function closeAllDropdowns(){
        dropdownParents.forEach(d => d.classList.remove('active'));
    }

    // âœ… FIXED: Replace :scope with universal selector
    document.querySelectorAll('.dropdown > a').forEach(link => {
        const dropdown = link.parentElement;
        
        link.addEventListener('click', function(e){
            if(window.innerWidth <= 768){
                e.preventDefault();
                e.stopPropagation();

                const isOpen = dropdown.classList.contains('active');
                closeAllDropdowns();
                if(!isOpen) dropdown.classList.add('active');
            }
        });
    });

    /* ========= OUTSIDE CLICK ========= */
    document.addEventListener('click', function(e){
        if(!navMenu.contains(e.target) && !mobileBtn.contains(e.target)){
            closeMenu();
        }
    });

    /* ========= SUBMENU LINK NAVIGATION ========= */
    document.querySelectorAll('.dropdown-menu a').forEach(link=>{
        link.addEventListener('click', ()=>{
            if(window.innerWidth <= 768) closeMenu();
        });
    });

    /* ========= ROTATION / DESKTOP ========= */
    let resizeTimer;
    window.addEventListener('resize', function(){
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function(){
            if(window.innerWidth > 992){
                closeMenu();
            }
        }, 250);
    });

});
</script>
