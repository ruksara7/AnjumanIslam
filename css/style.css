<script>
document.addEventListener('DOMContentLoaded', function () {
    const navMenu  = document.getElementById('navMenu');
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    const dropdownParents = document.querySelectorAll('.dropdown');

    /* ========= MAIN MENU ========= */
    function openMenu(){
        navMenu.classList.add('active');
        mobileBtn.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeMenu(){
        navMenu.classList.remove('active');
        mobileBtn.classList.remove('active');
        document.body.style.overflow = '';
        closeAllDropdowns();
    }

    mobileBtn.addEventListener('click', function(e){
        e.stopPropagation();
        navMenu.classList.contains('active') ? closeMenu() : openMenu();
    });

    /* ========= DROPDOWN - FIXED ========= */
    function closeAllDropdowns(){
        dropdownParents.forEach(d => d.classList.remove('active'));
    }

    document.querySelectorAll('.dropdown > a').forEach(link => {
        const dropdown = link.parentElement;
        
        link.addEventListener('click', function(e){
            if(window.innerWidth <= 768){
                const isOpen = dropdown.classList.contains('active');
                
                // ðŸ”¥ FIX #1: 2nd tap navigates to parent link
                if(isOpen){
                    return; // Let normal link navigation happen
                }
                
                e.preventDefault();
                e.stopPropagation();
                
                closeAllDropdowns();
                dropdown.classList.add('active'); // ðŸ”¥ FIX #2: Open after closeAll
            }
        });
    });

    /* ========= OUTSIDE CLICK ========= */
    document.addEventListener('click', function(e){
        if(!navMenu.contains(e.target) && !mobileBtn.contains(e.target)){
            closeMenu();
        }
    });

    /* ========= SUBMENU LINKS ========= */
    document.querySelectorAll('.dropdown-menu a').forEach(link=>{
        link.addEventListener('click', ()=>{
            if(window.innerWidth <= 768) {
                setTimeout(closeMenu, 100); // Small delay for smooth UX
            }
        });
    });

    /* ========= RESIZE - FIXED BREAKPOINT ========= */
    let resizeTimer;
    window.addEventListener('resize', function(){
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function(){
            if(window.innerWidth > 768){ // ðŸ”¥ FIX #3: Match CSS breakpoint
                closeMenu();
            }
        }, 250);
    });
});
</script>
